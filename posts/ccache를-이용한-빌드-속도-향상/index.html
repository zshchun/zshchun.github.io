<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Ccache를 이용한 빌드 속도 향상 | sh</title><meta name=keywords content><meta name=description content="개요 Build time을 줄이기 위해서는 다양한 방법이 존재한다. 여기서는"><meta name=author content="Seunghwan Chun"><link rel=canonical href=https://zshchun.github.io/posts/ccache%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%B9%8C%EB%93%9C-%EC%86%8D%EB%8F%84-%ED%96%A5%EC%83%81/><link crossorigin=anonymous href=/assets/css/stylesheet.0d2ee8bb1bc6a8196da0f4036d74cedc1fb80d74ab9f6160fc44670f9b85dd9c.css integrity="sha256-DS7ouxvGqBltoPQDbXTO3B+4DXSrn2Fg/ERnD5uF3Zw=" rel="preload stylesheet" as=style><link rel=icon href=https://zshchun.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zshchun.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://zshchun.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://zshchun.github.io/apple-touch-icon.png><link rel=mask-icon href=https://zshchun.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-228892904-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"))</script><meta property="og:title" content="Ccache를 이용한 빌드 속도 향상"><meta property="og:description" content="개요 Build time을 줄이기 위해서는 다양한 방법이 존재한다. 여기서는"><meta property="og:type" content="article"><meta property="og:url" content="https://zshchun.github.io/posts/ccache%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%B9%8C%EB%93%9C-%EC%86%8D%EB%8F%84-%ED%96%A5%EC%83%81/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-29T00:45:23+09:00"><meta property="article:modified_time" content="2023-05-29T00:45:23+09:00"><meta property="og:site_name" content="sh"><meta name=twitter:card content="summary"><meta name=twitter:title content="Ccache를 이용한 빌드 속도 향상"><meta name=twitter:description content="개요 Build time을 줄이기 위해서는 다양한 방법이 존재한다. 여기서는"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://zshchun.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Ccache를 이용한 빌드 속도 향상","item":"https://zshchun.github.io/posts/ccache%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%B9%8C%EB%93%9C-%EC%86%8D%EB%8F%84-%ED%96%A5%EC%83%81/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Ccache를 이용한 빌드 속도 향상","name":"Ccache를 이용한 빌드 속도 향상","description":"개요 Build time을 줄이기 위해서는 다양한 방법이 존재한다. 여기서는","keywords":[],"articleBody":"개요 Build time을 줄이기 위해서는 다양한 방법이 존재한다.\n여기서는 그 중에서 ccache를 이용한 compiler cache를 소개한다.\n사용방법 ccache 사용방법에는 PATH에 추가하는 방법과 command-line에 prefix를 추가하는 방법이 있다.\n아래는 ccache를 prefix로 추가하는 방법이다.\nccache gcc source.c 다른 하나는 아래와 같이 symbolic link로 컴파일러를 참조하도록 하는 방법이다.\nexport PATH=/usr/local/bin/:$PATH ln -s /usr/bin/ccache /usr/local/bin/gcc ln -s /usr/bin/ccache /usr/local/bin/g++ ln -s /usr/bin/ccache /usr/local/bin/cc ln -s /usr/bin/ccache /usr/local/bin/c++ cache 디렉토리는 CCACHE_DIR 와 $CCACHE_DIR/ccache.conf. 등의 환경변수를 참조하며 없으면 HOME 디렉토리의 .ccache 등을 참조한다.\ncache를 초기화 하기 위해서는 다음과 같이 초기화 할 수 있다.\nccache -c 원리 C/C++ 소스 파일을 pre-processing 결과를 md4/blake3 등의 hashing을 이용해 동일하면 해당 파일을 이용하는 것으로 보인다.\n최신 버전에서는 blake3를 사용하는 것을 확인했다.\n소개에 따르면 blake3는 MD5, SHA1 등의 hashing function 보다 빠르고 안전하며 병렬화에 장점을 가진다고 한다.\nBuild test ccache를 이용해 openssl 3.2.0을 빌드해보자 (core=1)\n./Configure time make option time w/ ccache 1st 3m33.900s w/ ccache 2nd 51.809s w/o ccache 4m2.339s 결론 보통 ccache를 이용한 첫 빌드는 ccache로 실행하는 편이 약간 더 걸리는데 여기서는 ccache를 사용하지 않은 편이 더 많은 시간이 소요되었다.\n중복 파일을 컴파일 하는 것으로 보인다.\nccache 를 이용한 방법 이외에도 network를 이용한 distcc 와 같은 분산형 컴파일 도구도 있다.\n두가지를 동시에 사용하기도 한다.\n","wordCount":"549","inLanguage":"en","datePublished":"2023-05-29T00:45:23+09:00","dateModified":"2023-05-29T00:45:23+09:00","author":{"@type":"Person","name":"Seunghwan Chun"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zshchun.github.io/posts/ccache%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%B9%8C%EB%93%9C-%EC%86%8D%EB%8F%84-%ED%96%A5%EC%83%81/"},"publisher":{"@type":"Organization","name":"sh","logo":{"@type":"ImageObject","url":"https://zshchun.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://zshchun.github.io/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://zshchun.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://zshchun.github.io/docs/ title=docs><span>docs</span></a></li><li><a href=https://zshchun.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://zshchun.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://zshchun.github.io/posts/>Posts</a></div><h1 class=post-title>Ccache를 이용한 빌드 속도 향상</h1><div class=post-meta><span title='2023-05-29 00:45:23 +0900 KST'>2023/05/29</span>&nbsp;·&nbsp;549 words&nbsp;·&nbsp;Seunghwan Chun</div></header><div class=post-content><h1 id=개요>개요<a hidden class=anchor aria-hidden=true href=#개요>#</a></h1><p>Build time을 줄이기 위해서는 다양한 방법이 존재한다.</p><p>여기서는 그 중에서 ccache를 이용한 compiler cache를 소개한다.</p><h1 id=사용방법>사용방법<a hidden class=anchor aria-hidden=true href=#사용방법>#</a></h1><p>ccache 사용방법에는 PATH에 추가하는 방법과 command-line에 prefix를 추가하는 방법이 있다.</p><p>아래는 ccache를 prefix로 추가하는 방법이다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>ccache gcc source.c
</span></span></code></pre></div><p>다른 하나는 아래와 같이 symbolic link로 컴파일러를 참조하도록 하는 방법이다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>export PATH<span style=color:#f92672>=</span>/usr/local/bin/:$PATH
</span></span><span style=display:flex><span>ln -s /usr/bin/ccache /usr/local/bin/gcc
</span></span><span style=display:flex><span>ln -s /usr/bin/ccache /usr/local/bin/g++
</span></span><span style=display:flex><span>ln -s /usr/bin/ccache /usr/local/bin/cc
</span></span><span style=display:flex><span>ln -s /usr/bin/ccache /usr/local/bin/c++
</span></span></code></pre></div><p>cache 디렉토리는 CCACHE_DIR 와 $CCACHE_DIR/ccache.conf. 등의 환경변수를 참조하며 없으면 HOME 디렉토리의 .ccache 등을 참조한다.</p><p>cache를 초기화 하기 위해서는 다음과 같이 초기화 할 수 있다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>ccache -c
</span></span></code></pre></div><h1 id=원리>원리<a hidden class=anchor aria-hidden=true href=#원리>#</a></h1><p>C/C++ 소스 파일을 pre-processing 결과를 md4/blake3 등의 hashing을 이용해 동일하면 해당 파일을 이용하는 것으로 보인다.</p><p>최신 버전에서는 <a href=https://github.com/BLAKE3-team/BLAKE3>blake3</a>를 사용하는 것을 확인했다.</p><p>소개에 따르면 blake3는 MD5, SHA1 등의 hashing function 보다 빠르고 안전하며 병렬화에 장점을 가진다고 한다.</p><h1 id=build-test>Build test<a hidden class=anchor aria-hidden=true href=#build-test>#</a></h1><p>ccache를 이용해 openssl 3.2.0을 빌드해보자 (core=1)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>./Configure
</span></span><span style=display:flex><span>time make
</span></span></code></pre></div><table><thead><tr><th style=text-align:center>option</th><th style=text-align:center>time</th></tr></thead><tbody><tr><td style=text-align:center>w/ ccache 1st</td><td style=text-align:center>3m33.900s</td></tr><tr><td style=text-align:center>w/ ccache 2nd</td><td style=text-align:center>51.809s</td></tr><tr><td style=text-align:center>w/o ccache</td><td style=text-align:center>4m2.339s</td></tr></tbody></table><h1 id=결론>결론<a hidden class=anchor aria-hidden=true href=#결론>#</a></h1><p>보통 ccache를 이용한 첫 빌드는 ccache로 실행하는 편이 약간 더 걸리는데 여기서는 ccache를 사용하지 않은 편이 더 많은 시간이 소요되었다.</p><p>중복 파일을 컴파일 하는 것으로 보인다.</p><p>ccache 를 이용한 방법 이외에도 network를 이용한 distcc 와 같은 분산형 컴파일 도구도 있다.</p><p>두가지를 동시에 사용하기도 한다.</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=https://zshchun.github.io/posts/%EC%95%94%ED%98%B8%ED%99%94%EB%90%9C-%ED%8C%8C%EC%9D%BC%EC%9D%98-%ED%8C%90%EB%B3%84/><span class=title>Next »</span><br><span>암호화된 파일의 판별</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://zshchun.github.io/>sh</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>