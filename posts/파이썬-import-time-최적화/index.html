<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>파이썬 import time 최적화 | sh</title>
<meta name=keywords content="python">
<meta name=description content="파이썬 스크립트에서 시작시간이 좀 느려서 최적화를 해보았다. 파이썬">
<meta name=author content="Seunghwan Chun">
<link rel=canonical href=https://zshchun.github.io/posts/%ED%8C%8C%EC%9D%B4%EC%8D%AC-import-time-%EC%B5%9C%EC%A0%81%ED%99%94/>
<link crossorigin=anonymous href=/assets/css/stylesheet.0d2ee8bb1bc6a8196da0f4036d74cedc1fb80d74ab9f6160fc44670f9b85dd9c.css integrity="sha256-DS7ouxvGqBltoPQDbXTO3B+4DXSrn2Fg/ERnD5uF3Zw=" rel="preload stylesheet" as=style>
<link rel=icon href=https://zshchun.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://zshchun.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://zshchun.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://zshchun.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://zshchun.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-228892904-1','auto'),ga('set','anonymizeIp',!0),ga('send','pageview'))</script><meta property="og:title" content="파이썬 import time 최적화">
<meta property="og:description" content="파이썬 스크립트에서 시작시간이 좀 느려서 최적화를 해보았다. 파이썬">
<meta property="og:type" content="article">
<meta property="og:url" content="https://zshchun.github.io/posts/%ED%8C%8C%EC%9D%B4%EC%8D%AC-import-time-%EC%B5%9C%EC%A0%81%ED%99%94/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-08-26T22:09:10+09:00">
<meta property="article:modified_time" content="2022-08-26T22:09:10+09:00"><meta property="og:site_name" content="sh">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="파이썬 import time 최적화">
<meta name=twitter:description content="파이썬 스크립트에서 시작시간이 좀 느려서 최적화를 해보았다. 파이썬">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://zshchun.github.io/posts/"},{"@type":"ListItem","position":2,"name":"파이썬 import time 최적화","item":"https://zshchun.github.io/posts/%ED%8C%8C%EC%9D%B4%EC%8D%AC-import-time-%EC%B5%9C%EC%A0%81%ED%99%94/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"파이썬 import time 최적화","name":"파이썬 import time 최적화","description":"파이썬 스크립트에서 시작시간이 좀 느려서 최적화를 해보았다. 파이썬","keywords":["python"],"articleBody":"파이썬 스크립트에서 시작시간이 좀 느려서 최적화를 해보았다.\n파이썬에는 실행시간 측정을 위해 cProfile과 -X importime 과 같은 좋은 기능이 있다.\n여기서는 실행 시간보다 라이브러리의 로딩 시간을 알아보기 위해 먼저 사용되는 라이브러리를 확인했다.\n$ grep import * | cut -d: -f2 | cut -d\\  -f2 | sort | uniq aiohttp argparse asyncio concurrent.futures ... 간단한 스크립트로 사용되는 라이브러리들의 import time을 확인했다.\n#!/bin/bash for module in aiohttp argparse asyncio \\  concurrent.futures Cryptodome.Cipher \\  datetime getpass json lxml operator \\  os random re sqlite3 subprocess sys \\  time tomli websockets bs4 do (time python3 -c \"import $module\") 2\u00261 | \\  awk \"/real/ {print sprintf(\\\"%-20s\\\", \\\"$module\\\") \\$2}\" done | sort -drk 2 결과는 다음과 같다.\naiohttp 0m0.375s bs4 0m0.225s Cryptodome.Cipher 0m0.159s asyncio 0m0.084s concurrent.futures 0m0.036s tomli 0m0.033s websockets 0m0.027s argparse 0m0.027s subprocess 0m0.026s json 0m0.025s re 0m0.023s sqlite3 0m0.021s getpass 0m0.021s random 0m0.018s datetime 0m0.017s lxml 0m0.016s operator 0m0.015s sys 0m0.015s time 0m0.014s os 0m0.014s aiohttp, beautifulsoup, Cryptodome 세 라이브러리만 벌써 750ms 이상 사용하고 있었다.\nAES 암호화를 위한 Cryptodome.Cipher는 당장 필요가 없어 제거했다. 필요한 경우 import time이 짧은 cryptography나 pyaes로 대체 가능하다.\nHTTP 클라이언트/서버 라이브러리인 aiohttp에 비해 경량화 클라이언트인 aiosonic으로 교체해 보았지만 아쉬운 부분이 있어서 남겨두었다.\nHTML 파싱을 위한 Beautiful Soup은 lxml으로 대체해서 0.2s 정도 단축할 수 있었다.\n일부 컴퓨터 환경에서 시작 시간이 대략 0.3초 정도 줄어들었다.\n","wordCount":"481","inLanguage":"en","datePublished":"2022-08-26T22:09:10+09:00","dateModified":"2022-08-26T22:09:10+09:00","author":{"@type":"Person","name":"Seunghwan Chun"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zshchun.github.io/posts/%ED%8C%8C%EC%9D%B4%EC%8D%AC-import-time-%EC%B5%9C%EC%A0%81%ED%99%94/"},"publisher":{"@type":"Organization","name":"sh","logo":{"@type":"ImageObject","url":"https://zshchun.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://zshchun.github.io/ accesskey=h title="Home (Alt + H)">Home</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://zshchun.github.io/tags/ title=tags>
<span>tags</span>
</a>
</li>
<li>
<a href=https://zshchun.github.io/docs/ title=docs>
<span>docs</span>
</a>
</li>
<li>
<a href=https://zshchun.github.io/search/ title="search (Alt + /)" accesskey=/>
<span>search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://zshchun.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://zshchun.github.io/posts/>Posts</a></div>
<h1 class=post-title>
파이썬 import time 최적화
</h1>
<div class=post-meta><span title="2022-08-26 22:09:10 +0900 KST">2022/08/26</span>&nbsp;·&nbsp;481 words&nbsp;·&nbsp;Seunghwan Chun
</div>
</header>
<div class=post-content><p>파이썬 스크립트에서 시작시간이 좀 느려서 최적화를 해보았다.</p>
<p>파이썬에는 실행시간 측정을 위해 <a href=https://docs.python.org/3/library/profile.html>cProfile</a>과 <a href=https://docs.python.org/3/using/cmdline.html#cmdoption-X>-X importime</a> 과 같은 좋은 기능이 있다.</p>
<p>여기서는 실행 시간보다 라이브러리의 로딩 시간을 알아보기 위해 먼저 사용되는 라이브러리를 확인했다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh>$ grep import * | cut -d: -f2 | cut -d<span style=color:#ae81ff>\ </span> -f2 | sort | uniq

aiohttp
argparse
asyncio
concurrent.futures
...
</code></pre></div><p>간단한 스크립트로 사용되는 라이브러리들의 import time을 확인했다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=color:#75715e>#!/bin/bash
</span><span style=color:#75715e></span><span style=color:#66d9ef>for</span> module in aiohttp argparse asyncio <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>        concurrent.futures Cryptodome.Cipher <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>        datetime getpass json lxml operator <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>        os random re sqlite3 subprocess sys <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>        time tomli websockets bs4
<span style=color:#66d9ef>do</span>
        <span style=color:#f92672>(</span>time python3 -c <span style=color:#e6db74>&#34;import </span>$module<span style=color:#e6db74>&#34;</span><span style=color:#f92672>)</span> 2&gt;&amp;<span style=color:#ae81ff>1</span> | <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>        awk <span style=color:#e6db74>&#34;/real/ {print sprintf(\&#34;%-20s\&#34;, \&#34;</span>$module<span style=color:#e6db74>\&#34;) \$2}&#34;</span>
<span style=color:#66d9ef>done</span> | sort -drk <span style=color:#ae81ff>2</span>
</code></pre></div><p>결과는 다음과 같다.</p>
<pre tabindex=0><code>aiohttp             0m0.375s
bs4                 0m0.225s
Cryptodome.Cipher   0m0.159s
asyncio             0m0.084s
concurrent.futures  0m0.036s
tomli               0m0.033s
websockets          0m0.027s
argparse            0m0.027s
subprocess          0m0.026s
json                0m0.025s
re                  0m0.023s
sqlite3             0m0.021s
getpass             0m0.021s
random              0m0.018s
datetime            0m0.017s
lxml                0m0.016s
operator            0m0.015s
sys                 0m0.015s
time                0m0.014s
os                  0m0.014s
</code></pre><p>aiohttp, beautifulsoup, Cryptodome 세 라이브러리만 벌써 750ms 이상 사용하고 있었다.</p>
<p>AES 암호화를 위한 <a href=https://pycryptodome.readthedocs.io/en/latest/src/cipher/cipher.html>Cryptodome.Cipher</a>는 당장 필요가 없어 제거했다. 필요한 경우 import time이 짧은 <a href=https://github.com/pyca/cryptography>cryptography</a>나 <a href=https://github.com/ricmoo/pyaes>pyaes</a>로 대체 가능하다.</p>
<p>HTTP 클라이언트/서버 라이브러리인 <a href=https://docs.aiohttp.org/en/stable/>aiohttp</a>에 비해 경량화 클라이언트인 <a href=https://github.com/sonic182/aiosonic>aiosonic</a>으로 교체해 보았지만 아쉬운 부분이 있어서 남겨두었다.</p>
<p>HTML 파싱을 위한 <a href=https://www.crummy.com/software/BeautifulSoup/bs4/doc/>Beautiful Soup</a>은 <a href=https://lxml.de/>lxml</a>으로 대체해서 0.2s 정도 단축할 수 있었다.</p>
<p>일부 컴퓨터 환경에서 시작 시간이 대략 0.3초 정도 줄어들었다.</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://zshchun.github.io/tags/python/>python</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://zshchun.github.io/posts/mprotect%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%BD%94%EB%93%9C-%EC%8B%A4%ED%96%89/>
<span class=title>« Prev</span>
<br>
<span>mprotect를 이용한 코드 실행</span>
</a>
<a class=next href=https://zshchun.github.io/posts/bin/sh%EC%99%80-/bin/bash%EC%9D%98-%EC%B0%A8%EC%9D%B4/>
<span class=title>Next »</span>
<br>
<span>/bin/sh와 /bin/bash의 차이</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://zshchun.github.io/>sh</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerHTML='copy';function d(){a.innerHTML='copied!',setTimeout(()=>{a.innerHTML='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>