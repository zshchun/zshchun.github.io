<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>유용한 bit 관련 함수 | sh</title><meta name=keywords content="c,bithacks"><meta name=description content="bit의 위치나 갯수를 구하는 경우 gcc, clang등의 컴파일러는 내장"><meta name=author content="Seunghwan Chun"><link rel=canonical href=https://zshchun.github.io/posts/%EC%9C%A0%EC%9A%A9%ED%95%9C-bit-%EA%B4%80%EB%A0%A8-%ED%95%A8%EC%88%98/><link crossorigin=anonymous href=/assets/css/stylesheet.0d2ee8bb1bc6a8196da0f4036d74cedc1fb80d74ab9f6160fc44670f9b85dd9c.css integrity="sha256-DS7ouxvGqBltoPQDbXTO3B+4DXSrn2Fg/ERnD5uF3Zw=" rel="preload stylesheet" as=style><link rel=icon href=https://zshchun.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zshchun.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://zshchun.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://zshchun.github.io/apple-touch-icon.png><link rel=mask-icon href=https://zshchun.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-228892904-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"))</script><meta property="og:title" content="유용한 bit 관련 함수"><meta property="og:description" content="bit의 위치나 갯수를 구하는 경우 gcc, clang등의 컴파일러는 내장"><meta property="og:type" content="article"><meta property="og:url" content="https://zshchun.github.io/posts/%EC%9C%A0%EC%9A%A9%ED%95%9C-bit-%EA%B4%80%EB%A0%A8-%ED%95%A8%EC%88%98/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-08T01:05:40+09:00"><meta property="article:modified_time" content="2022-08-08T01:05:40+09:00"><meta property="og:site_name" content="sh"><meta name=twitter:card content="summary"><meta name=twitter:title content="유용한 bit 관련 함수"><meta name=twitter:description content="bit의 위치나 갯수를 구하는 경우 gcc, clang등의 컴파일러는 내장"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://zshchun.github.io/posts/"},{"@type":"ListItem","position":2,"name":"유용한 bit 관련 함수","item":"https://zshchun.github.io/posts/%EC%9C%A0%EC%9A%A9%ED%95%9C-bit-%EA%B4%80%EB%A0%A8-%ED%95%A8%EC%88%98/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"유용한 bit 관련 함수","name":"유용한 bit 관련 함수","description":"bit의 위치나 갯수를 구하는 경우 gcc, clang등의 컴파일러는 내장","keywords":["c","bithacks"],"articleBody":"bit의 위치나 갯수를 구하는 경우 gcc, clang등의 컴파일러는 내장 비트 연산 함수를 지원한다.\n간단한 코드를 살펴보자.\n1#include 2 3// for i in range(22): print('\"{}\", '.format(re.sub(r'(\\d{4})', r'\\1 ', bin(i)[2:].rjust(32, '0')).rstrip()), end='') 4char *bits[] = { \"0000 0000 0000 0000 0000 0000 0000 0000\", \"0000 0000 0000 0000 0000 0000 0000 0001\", \"0000 0000 0000 0000 0000 0000 0000 0010\", \"0000 0000 0000 0000 0000 0000 0000 0011\", \"0000 0000 0000 0000 0000 0000 0000 0100\", \"0000 0000 0000 0000 0000 0000 0000 0101\", \"0000 0000 0000 0000 0000 0000 0000 0110\", \"0000 0000 0000 0000 0000 0000 0000 0111\", \"0000 0000 0000 0000 0000 0000 0000 1000\", \"0000 0000 0000 0000 0000 0000 0000 1001\", \"0000 0000 0000 0000 0000 0000 0000 1010\", \"0000 0000 0000 0000 0000 0000 0000 1011\", \"0000 0000 0000 0000 0000 0000 0000 1100\", \"0000 0000 0000 0000 0000 0000 0000 1101\", \"0000 0000 0000 0000 0000 0000 0000 1110\", \"0000 0000 0000 0000 0000 0000 0000 1111\", \"0000 0000 0000 0000 0000 0000 0001 0000\", \"0000 0000 0000 0000 0000 0000 0001 0001\", \"0000 0000 0000 0000 0000 0000 0001 0010\", \"0000 0000 0000 0000 0000 0000 0001 0011\", \"0000 0000 0000 0000 0000 0000 0001 0100\", \"0000 0000 0000 0000 0000 0000 0001 0101\" }; 5 6int main() { 7\tfor (int i=0;i\u003c21;i++) { 8\tprintf(\"%s clz: %d ffs: %d popcount: %d\\n\", \\ 9\tbits[i], \\ 10\t__builtin_clz(i), \\ 11\t__builtin_ffs(i), \\ 12\t__builtin_popcount(i)); 13\t} 14\treturn 0; 15} Output 0000 0000 0000 0000 0000 0000 0000 0000 clz: 31 ffs: 0 popcount: 0 0000 0000 0000 0000 0000 0000 0000 0001 clz: 31 ffs: 1 popcount: 1 0000 0000 0000 0000 0000 0000 0000 0010 clz: 30 ffs: 2 popcount: 1 0000 0000 0000 0000 0000 0000 0000 0011 clz: 30 ffs: 1 popcount: 2 0000 0000 0000 0000 0000 0000 0000 0100 clz: 29 ffs: 3 popcount: 1 0000 0000 0000 0000 0000 0000 0000 0101 clz: 29 ffs: 1 popcount: 2 0000 0000 0000 0000 0000 0000 0000 0110 clz: 29 ffs: 2 popcount: 2 0000 0000 0000 0000 0000 0000 0000 0111 clz: 29 ffs: 1 popcount: 3 0000 0000 0000 0000 0000 0000 0000 1000 clz: 28 ffs: 4 popcount: 1 0000 0000 0000 0000 0000 0000 0000 1001 clz: 28 ffs: 1 popcount: 2 0000 0000 0000 0000 0000 0000 0000 1010 clz: 28 ffs: 2 popcount: 2 0000 0000 0000 0000 0000 0000 0000 1011 clz: 28 ffs: 1 popcount: 3 0000 0000 0000 0000 0000 0000 0000 1100 clz: 28 ffs: 3 popcount: 2 0000 0000 0000 0000 0000 0000 0000 1101 clz: 28 ffs: 1 popcount: 3 0000 0000 0000 0000 0000 0000 0000 1110 clz: 28 ffs: 2 popcount: 3 0000 0000 0000 0000 0000 0000 0000 1111 clz: 28 ffs: 1 popcount: 4 0000 0000 0000 0000 0000 0000 0001 0000 clz: 27 ffs: 5 popcount: 1 0000 0000 0000 0000 0000 0000 0001 0001 clz: 27 ffs: 1 popcount: 2 0000 0000 0000 0000 0000 0000 0001 0010 clz: 27 ffs: 2 popcount: 2 0000 0000 0000 0000 0000 0000 0001 0011 clz: 27 ffs: 1 popcount: 3 0000 0000 0000 0000 0000 0000 0001 0100 clz: 27 ffs: 3 popcount: 2 __builtin_clz : 상위 비트(MSB)부터 0의 갯수, 입력 0에 대해 보장하지 않음 (undefined) __builtin_ffs : 하위 비트(LSB)부터 첫번째 1의 위치, 못찾으면 0 __builtin_popcount : 비트 1의 갯수\nclz는 0의 경우도 1인 경우도 31인 것을 볼 수 있다. 0인 경우 처리를 해야한다.\n이 외에 ctz 등의 함수도 있다.\n__builtin_ctz : 하위 비트(LSB)부터 0의 갯수, 입력 0에 대해 보장하지 않음 (undefined)\nAssembly 1# gcc -O2 -S -march=native test.c 2... 3 tzcntl %ebx, %r8d 4 popcntl %ebx, %r9d 5 lzcntl %ebx, %ecx 1# gcc -O2 -m32 -S test.c 2... 3 pushl %esi 4 call __popcountsi2@PLT 5 xorl %edx, %edx 6 addl $16, %esp 7 rep bsfl %esi, %edx 8 addl $1, %edx 9 bsrl %esi, %ecx 10 xorl $31, %ecx 1# aarch64-linux-gnu-gcc -O2 -S test.c 2... 3 cnt v0.8b, v0.8b 4 rbit w4, w19 5 clz w4, w4 6 clz w3, w19 7 add w4, w4, 1 8 add x19, x19, 1 9 addv b0, v0.8b x86 : bsf, bsr x86_64 : tzcnt, popcnt, lzcnt arm64 : clz, cnt 등의 어셈블리 명령어가 사용되는 것을 볼 수 있다.\n이처럼 아키텍처마다 instruction 레벨에서 bit 연산을 지원 한다.\n기타 위의 내장 함수들은 32비트 기준이며 long 타입과 long long 타입은 __builtin_ffsll과 같이 l, ll 접미사를 붙인다.\n*nix 계열에서는 보통 LP64 모델을 사용하며 long 또는 long long을 사용하면 64비트가 된다.\n1 대신 0을 찾는등 반대의 경우는 Bitwise NOT(~) 연산으로 비트를 뒤집으면 된다.\n그 외에도 아래의 popcount 구현처럼 많은 bit hack들이 존재한다.\n1int swar(uint32_t i) { 2 i = i - ((i \u003e\u003e 1) \u0026 0x55555555); 3 i = (i \u0026 0x33333333) + ((i \u003e\u003e 2) \u0026 0x33333333); 4 return (((i + (i \u003e\u003e 4)) \u0026 0x0F0F0F0F) * 0x01010101) \u003e\u003e 24; 5} 더 관심이 있다면 Bit Twiddling Hacks이나 Linux 소스코드 등 에서 더 많은 것을 찾아볼 수 있다.\nReferences Wiki: Find first set GCC builtin extensions\n","wordCount":"1106","inLanguage":"en","datePublished":"2022-08-08T01:05:40+09:00","dateModified":"2022-08-08T01:05:40+09:00","author":{"@type":"Person","name":"Seunghwan Chun"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zshchun.github.io/posts/%EC%9C%A0%EC%9A%A9%ED%95%9C-bit-%EA%B4%80%EB%A0%A8-%ED%95%A8%EC%88%98/"},"publisher":{"@type":"Organization","name":"sh","logo":{"@type":"ImageObject","url":"https://zshchun.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://zshchun.github.io/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://zshchun.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://zshchun.github.io/docs/ title=docs><span>docs</span></a></li><li><a href=https://zshchun.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://zshchun.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://zshchun.github.io/posts/>Posts</a></div><h1 class=post-title>유용한 bit 관련 함수</h1><div class=post-meta><span title='2022-08-08 01:05:40 +0900 KST'>2022/08/08</span>&nbsp;·&nbsp;1106 words&nbsp;·&nbsp;Seunghwan Chun</div></header><div class=post-content><p>bit의 위치나 갯수를 구하는 경우 gcc, clang등의 컴파일러는 내장 비트 연산 함수를 지원한다.</p><p>간단한 코드를 살펴보자.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#75715e>// for i in range(22): print(&#39;&#34;{}&#34;, &#39;.format(re.sub(r&#39;(\d{4})&#39;, r&#39;\1 &#39;, bin(i)[2:].rjust(32, &#39;0&#39;)).rstrip()), end=&#39;&#39;)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#75715e></span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>bits[] <span style=color:#f92672>=</span> { <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0000 0000&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0000 0001&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0000 0010&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0000 0011&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0000 0100&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0000 0101&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0000 0110&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0000 0111&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0000 1000&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0000 1001&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0000 1010&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0000 1011&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0000 1100&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0000 1101&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0000 1110&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0000 1111&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0001 0000&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0001 0001&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0001 0010&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0001 0011&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0001 0100&#34;</span>, <span style=color:#e6db74>&#34;0000 0000 0000 0000 0000 0000 0001 0101&#34;</span> };
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>		<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>21</span>;i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>				printf(<span style=color:#e6db74>&#34;%s clz: %d ffs: %d popcount: %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, \
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>				bits[i], \
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>				__builtin_clz(i), \
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>				__builtin_ffs(i), \
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>				__builtin_popcount(i));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>		<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>}
</span></span></code></pre></div><h1 id=output>Output<a hidden class=anchor aria-hidden=true href=#output>#</a></h1><pre tabindex=0><code>0000 0000 0000 0000 0000 0000 0000 0000 clz: 31 ffs: 0 popcount: 0
0000 0000 0000 0000 0000 0000 0000 0001 clz: 31 ffs: 1 popcount: 1
0000 0000 0000 0000 0000 0000 0000 0010 clz: 30 ffs: 2 popcount: 1
0000 0000 0000 0000 0000 0000 0000 0011 clz: 30 ffs: 1 popcount: 2
0000 0000 0000 0000 0000 0000 0000 0100 clz: 29 ffs: 3 popcount: 1
0000 0000 0000 0000 0000 0000 0000 0101 clz: 29 ffs: 1 popcount: 2
0000 0000 0000 0000 0000 0000 0000 0110 clz: 29 ffs: 2 popcount: 2
0000 0000 0000 0000 0000 0000 0000 0111 clz: 29 ffs: 1 popcount: 3
0000 0000 0000 0000 0000 0000 0000 1000 clz: 28 ffs: 4 popcount: 1
0000 0000 0000 0000 0000 0000 0000 1001 clz: 28 ffs: 1 popcount: 2
0000 0000 0000 0000 0000 0000 0000 1010 clz: 28 ffs: 2 popcount: 2
0000 0000 0000 0000 0000 0000 0000 1011 clz: 28 ffs: 1 popcount: 3
0000 0000 0000 0000 0000 0000 0000 1100 clz: 28 ffs: 3 popcount: 2
0000 0000 0000 0000 0000 0000 0000 1101 clz: 28 ffs: 1 popcount: 3
0000 0000 0000 0000 0000 0000 0000 1110 clz: 28 ffs: 2 popcount: 3
0000 0000 0000 0000 0000 0000 0000 1111 clz: 28 ffs: 1 popcount: 4
0000 0000 0000 0000 0000 0000 0001 0000 clz: 27 ffs: 5 popcount: 1
0000 0000 0000 0000 0000 0000 0001 0001 clz: 27 ffs: 1 popcount: 2
0000 0000 0000 0000 0000 0000 0001 0010 clz: 27 ffs: 2 popcount: 2
0000 0000 0000 0000 0000 0000 0001 0011 clz: 27 ffs: 1 popcount: 3
0000 0000 0000 0000 0000 0000 0001 0100 clz: 27 ffs: 3 popcount: 2
</code></pre><p><strong>__builtin_clz</strong> : 상위 비트(MSB)부터 0의 갯수, 입력 0에 대해 보장하지 않음 (undefined)<br><strong>__builtin_ffs</strong> : 하위 비트(LSB)부터 첫번째 1의 위치, 못찾으면 0<br><strong>__builtin_popcount</strong> : 비트 1의 갯수</p><p>clz는 0의 경우도 1인 경우도 31인 것을 볼 수 있다. 0인 경우 처리를 해야한다.</p><p>이 외에 ctz 등의 함수도 있다.</p><p><strong>__builtin_ctz</strong> : 하위 비트(LSB)부터 0의 갯수, 입력 0에 대해 보장하지 않음 (undefined)</p><h1 id=assembly>Assembly<a hidden class=anchor aria-hidden=true href=#assembly>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-asm data-lang=asm><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e># gcc -O2 -S -march=native test.c
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#75715e></span><span style=color:#a6e22e>...</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>        <span style=color:#a6e22e>tzcntl</span>  %ebx, %r8d
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>        <span style=color:#a6e22e>popcntl</span> %ebx, %r9d
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>        <span style=color:#a6e22e>lzcntl</span>  %ebx, %ecx
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-asm data-lang=asm><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#75715e># gcc -O2 -m32 -S test.c
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#75715e></span><span style=color:#a6e22e>...</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>        <span style=color:#a6e22e>pushl</span>   %esi
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>        <span style=color:#a6e22e>call</span>    <span style=color:#66d9ef>__popcountsi2@PLT</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>        <span style=color:#a6e22e>xorl</span>    %edx, %edx
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>        <span style=color:#a6e22e>addl</span>    <span style=color:#66d9ef>$16</span>, %esp
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>        <span style=color:#a6e22e>rep</span> <span style=color:#a6e22e>bsfl</span>        %esi, %edx
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>        <span style=color:#a6e22e>addl</span>    <span style=color:#66d9ef>$1</span>, %edx
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>        <span style=color:#a6e22e>bsrl</span>    %esi, %ecx
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>        <span style=color:#a6e22e>xorl</span>    <span style=color:#66d9ef>$31</span>, %ecx
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-asm data-lang=asm><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e># aarch64-linux-gnu-gcc -O2 -S test.c
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#75715e></span><span style=color:#a6e22e>...</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>        <span style=color:#a6e22e>cnt</span>     <span style=color:#66d9ef>v0.8b</span>, <span style=color:#66d9ef>v0.8b</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>        <span style=color:#a6e22e>rbit</span>    <span style=color:#66d9ef>w4</span>, <span style=color:#66d9ef>w19</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>        <span style=color:#a6e22e>clz</span>     <span style=color:#66d9ef>w4</span>, <span style=color:#66d9ef>w4</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>        <span style=color:#a6e22e>clz</span>     <span style=color:#66d9ef>w3</span>, <span style=color:#66d9ef>w19</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>        <span style=color:#a6e22e>add</span>     <span style=color:#66d9ef>w4</span>, <span style=color:#66d9ef>w4</span>, <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>        <span style=color:#a6e22e>add</span>     <span style=color:#66d9ef>x19</span>, <span style=color:#66d9ef>x19</span>, <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>        <span style=color:#a6e22e>addv</span>    <span style=color:#66d9ef>b0</span>, <span style=color:#66d9ef>v0.8b</span>
</span></span></code></pre></div><ul><li>x86 : bsf, bsr</li><li>x86_64 : tzcnt, popcnt, lzcnt</li><li>arm64 : clz, cnt</li></ul><p>등의 어셈블리 명령어가 사용되는 것을 볼 수 있다.</p><p>이처럼 아키텍처마다 instruction 레벨에서 <a href=https://en.wikipedia.org/wiki/Find_first_set#Hardware_support>bit 연산을 지원</a> 한다.</p><h1 id=기타>기타<a hidden class=anchor aria-hidden=true href=#기타>#</a></h1><p>위의 내장 함수들은 32비트 기준이며 long 타입과 long long 타입은 __builtin_ffs<strong>ll</strong>과 같이 l, ll 접미사를 붙인다.</p><p>*nix 계열에서는 보통 <a href=https://en.wikipedia.org/wiki/64-bit_computing#64-bit_data_models>LP64 모델</a>을 사용하며 long 또는 long long을 사용하면 64비트가 된다.</p><p>1 대신 0을 찾는등 반대의 경우는 Bitwise NOT(~) 연산으로 비트를 뒤집으면 된다.</p><p>그 외에도 아래의 popcount 구현처럼 많은 bit hack들이 존재한다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>swar</span>(<span style=color:#66d9ef>uint32_t</span> i) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>  i <span style=color:#f92672>=</span> i <span style=color:#f92672>-</span> ((i <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0x55555555</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>  i <span style=color:#f92672>=</span> (i <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0x33333333</span>) <span style=color:#f92672>+</span> ((i <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0x33333333</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>  <span style=color:#66d9ef>return</span> (((i <span style=color:#f92672>+</span> (i <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>4</span>)) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0x0F0F0F0F</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>0x01010101</span>) <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>24</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>}
</span></span></code></pre></div><p>더 관심이 있다면 <a href=http://graphics.stanford.edu/~seander/bithacks.html>Bit Twiddling Hacks</a>이나 <a href=https://github.com/torvalds/linux/tree/master/include/asm-generic/bitops>Linux 소스코드</a> 등 에서 더 많은 것을 찾아볼 수 있다.</p><h1 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h1><p><a href=https://en.wikipedia.org/wiki/Find_first_set>Wiki: Find first set</a><br><a href=https://gcc.gnu.org/onlinedocs/gcc/Other-Builtins.html>GCC builtin extensions</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://zshchun.github.io/tags/c/>c</a></li><li><a href=https://zshchun.github.io/tags/bithacks/>bithacks</a></li></ul><nav class=paginav><a class=prev href=https://zshchun.github.io/posts/linux-syscall-list-x86/arm/><span class=title>« Prev</span><br><span>Linux syscall list (x86/arm)</span></a>
<a class=next href=https://zshchun.github.io/posts/map%EA%B3%BC-unordered-map%EC%9D%98-%EC%B0%A8%EC%9D%B4/><span class=title>Next »</span><br><span>map과 unordered map의 차이</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://zshchun.github.io/>sh</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>